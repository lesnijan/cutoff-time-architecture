<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cutoff Time System - Demo Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .status-accepting { background: #22c55e; color: white; }
        .status-warning { background: #f59e0b; color: white; }
        .status-critical { background: #ef4444; color: white; }
        .status-closed { background: #dc2626; color: white; }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #666;
            font-weight: 500;
        }

        .metric-value {
            color: #333;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.3s ease;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-test {
            background: #22c55e;
        }

        .btn-test:hover {
            background: #16a34a;
        }

        .scenario-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-weight: 500;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
        }

        .response-box {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .response-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .api-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }

        .api-link:hover {
            text-decoration: underline;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¯ Cutoff Time System - Demo Dashboard</h1>
            <p class="subtitle">Dynamic Warehouse Capacity Management System</p>
            <p style="margin-top: 10px;">
                <a href="/api/v1/docs" class="api-link" target="_blank">ðŸ“š API Documentation</a> |
                <a href="/api/v1/redoc" class="api-link" target="_blank">ðŸ“– ReDoc</a>
            </p>
        </div>

        <div class="grid">
            <!-- Current Status Card -->
            <div class="card">
                <h2>ðŸ“Š Current Warehouse Status</h2>
                <div id="currentStatus" class="loading pulsing">Loading...</div>
            </div>

            <!-- Scenario Selector Card -->
            <div class="card">
                <h2>ðŸŽ¬ Demo Scenarios</h2>
                <p style="color: #666; margin-bottom: 15px;">
                    Switch between different warehouse states to test the system:
                </p>
                <div class="scenario-buttons" id="scenarioButtons">
                    <button class="btn" onclick="setScenario('normal')">Normal Operations</button>
                    <button class="btn" onclick="setScenario('low')">Low Utilization</button>
                    <button class="btn" onclick="setScenario('high')">High Utilization</button>
                    <button class="btn" onclick="setScenario('overload')">Overloaded</button>
                </div>
                <div id="scenarioResponse" class="response-box" style="display: none;"></div>
            </div>

            <!-- Test Capacity Check Card -->
            <div class="card">
                <h2>ðŸ§ª Test Capacity Check</h2>
                <div class="form-group">
                    <label>Product ID:</label>
                    <select id="productId">
                        <option value="MAT-001">MAT-001 - Standard Box (Small)</option>
                        <option value="MAT-002">MAT-002 - Heavy Equipment</option>
                        <option value="MAT-003">MAT-003 - High Shelf Item</option>
                        <option value="MAT-004">MAT-004 - Bulk Material</option>
                        <option value="MAT-005">MAT-005 - Lightweight Package</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantity:</label>
                    <input type="number" id="quantity" value="10" min="1" max="1000">
                </div>
                <div class="form-group">
                    <label>Priority:</label>
                    <select id="priority">
                        <option value="STANDARD">STANDARD</option>
                        <option value="EXPRESS">EXPRESS</option>
                        <option value="VIP">VIP</option>
                    </select>
                </div>
                <button class="btn btn-test" onclick="testCapacityCheck()">Check Capacity</button>
                <div id="capacityResponse" class="response-box" style="display: none;"></div>
            </div>
        </div>

        <!-- Detailed Metrics -->
        <div class="card">
            <h2>ðŸ“ˆ Detailed Metrics</h2>
            <div id="detailedMetrics" class="loading pulsing">Loading...</div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/v1';

        // Load current status
        async function loadStatus() {
            try {
                const response = await fetch(`${API_BASE}/cutoff/current`);
                const data = await response.json();

                const statusHTML = `
                    <div class="status-badge status-${data.status.toLowerCase()}">${data.status}</div>
                    <div class="metric">
                        <span class="metric-label">Current Utilization:</span>
                        <span class="metric-value">${(data.current_utilization * 100).toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${data.current_utilization * 100}%">
                            ${(data.current_utilization * 100).toFixed(1)}%
                        </div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Cutoff Time:</span>
                        <span class="metric-value">${new Date(data.cutoff_time).toLocaleTimeString()}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Time Remaining:</span>
                        <span class="metric-value">${data.time_remaining_minutes} min</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Orders in Queue:</span>
                        <span class="metric-value">${data.orders_in_queue}</span>
                    </div>
                `;

                document.getElementById('currentStatus').innerHTML = statusHTML;
            } catch (error) {
                document.getElementById('currentStatus').innerHTML =
                    `<p style="color: red;">Error loading status: ${error.message}</p>`;
            }
        }

        // Load detailed metrics
        async function loadDetailedMetrics() {
            try {
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();

                const metricsHTML = `
                    <div class="grid">
                        <div>
                            <h3 style="margin-bottom: 15px;">Workload Breakdown</h3>
                            <div class="metric">
                                <span class="metric-label">Total Orders:</span>
                                <span class="metric-value">${data.workload.total_orders}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">NEW:</span>
                                <span class="metric-value">${data.workload.by_status.NEW || 0}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">PICKING:</span>
                                <span class="metric-value">${data.workload.by_status.PICKING || 0}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">PACKING:</span>
                                <span class="metric-value">${data.workload.by_status.PACKING || 0}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">LOADING:</span>
                                <span class="metric-value">${data.workload.by_status.LOADING || 0}</span>
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px;">Capacity Status</h3>
                            <div class="metric">
                                <span class="metric-label">Total Capacity:</span>
                                <span class="metric-value">${data.capacity.total_capacity}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Used Capacity:</span>
                                <span class="metric-value">${data.capacity.used_capacity}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Available:</span>
                                <span class="metric-value">${data.capacity.available_capacity}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Bottleneck:</span>
                                <span class="metric-value">${data.capacity.bottleneck}</span>
                            </div>
                        </div>
                        <div>
                            <h3 style="margin-bottom: 15px;">Today's Decisions</h3>
                            <div class="metric">
                                <span class="metric-label">Total:</span>
                                <span class="metric-value">${data.decisions_today.total}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Approved:</span>
                                <span class="metric-value" style="color: #22c55e;">${data.decisions_today.approved}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Rejected:</span>
                                <span class="metric-value" style="color: #ef4444;">${data.decisions_today.rejected}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Approval Rate:</span>
                                <span class="metric-value">${(data.decisions_today.approval_rate * 100).toFixed(0)}%</span>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('detailedMetrics').innerHTML = metricsHTML;
            } catch (error) {
                document.getElementById('detailedMetrics').innerHTML =
                    `<p style="color: red;">Error loading metrics: ${error.message}</p>`;
            }
        }

        // Set scenario
        async function setScenario(scenario) {
            try {
                const response = await fetch(`${API_BASE}/demo/scenario/${scenario}`, {
                    method: 'POST'
                });
                const data = await response.json();

                const responseDiv = document.getElementById('scenarioResponse');
                responseDiv.style.display = 'block';
                responseDiv.innerHTML = `
                    <h4 style="color: #22c55e; margin-bottom: 10px;">âœ“ Scenario Changed!</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;

                // Reload status
                setTimeout(() => {
                    loadStatus();
                    loadDetailedMetrics();
                }, 500);
            } catch (error) {
                document.getElementById('scenarioResponse').innerHTML =
                    `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Test capacity check
        async function testCapacityCheck() {
            const productId = document.getElementById('productId').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const priority = document.getElementById('priority').value;

            try {
                const response = await fetch(`${API_BASE}/capacity/check`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        order_id: `TEST-${Date.now()}`,
                        priority: priority,
                        warehouse_id: 'WH-MAIN',
                        items: [
                            {
                                product_id: productId,
                                quantity: quantity
                            }
                        ]
                    })
                });

                const data = await response.json();
                const responseDiv = document.getElementById('capacityResponse');
                responseDiv.style.display = 'block';

                const canShip = data.can_ship_today;
                responseDiv.innerHTML = `
                    <h4 style="color: ${canShip ? '#22c55e' : '#ef4444'}; margin-bottom: 10px;">
                        ${canShip ? 'âœ“' : 'âœ—'} ${data.message}
                    </h4>
                    <div class="metric">
                        <span class="metric-label">Confidence:</span>
                        <span class="metric-value">${(data.confidence * 100).toFixed(0)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Utilization:</span>
                        <span class="metric-value">${(data.current_utilization * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Workload Impact:</span>
                        <span class="metric-value">${data.decision_factors.workload_impact} min</span>
                    </div>
                    <details style="margin-top: 10px;">
                        <summary style="cursor: pointer; color: #667eea; font-weight: bold;">View Full Response</summary>
                        <pre style="margin-top: 10px; font-size: 0.85rem;">${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;

                // Reload status
                loadStatus();
            } catch (error) {
                document.getElementById('capacityResponse').innerHTML =
                    `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadStatus();
            loadDetailedMetrics();
        }, 30000);

        // Initial load
        loadStatus();
        loadDetailedMetrics();
    </script>
</body>
</html>
